{
    "id": "fr.natron.Natron",
    "runtime": "org.freedesktop.Sdk",
    "runtime-version": "19.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "Natron",
    "rename-icon": "natronIcon256_linux",
    "finish-args": [
            "--share=ipc",
            "--socket=x11",
            "--socket=pulseaudio",
            "--filesystem=host",
            "--device=dri"
    ],
    "modules": [
            "shared-modules/glew/glew.json",
            "shared-modules/glu/glu-9.0.0.json",
            "shared-modules/python2.7/python-2.7.json",
    {
            "name": "qt4",
            "config-opts": [
                    "-no-multimedia",
                    "-no-gif",
                    "-qt-libpng",
                    "-no-libmng",
                    "-no-libtiff",
                    "-no-libjpeg",
                    "-no-static",
                    "-shared",
                    "-openssl-linked",
                    "-confirm-license",
                    "-release",
                    "-opensource",
                    "-nomake", "demos",
                    "-nomake", "docs",
                    "-nomake", "examples",
                    "-no-gtkstyle",
                    "-no-webkit",
                    "-no-avx",
                    "-no-openvg",
                    "-no-phonon",
                    "-no-phonon-backend",
                    "-xmlpatterns"
    ],
    "build-options": {
        "env": {
            "CXXFLAGS": "-std=gnu++98 -O2",
            "LD_LIBRARY_PATH": "/run/build/qt4/lib/"
        }
    },
    "sources": [
        {
            "type": "archive",
            "url": "https://download.qt.io/archive/qt/4.8/4.8.7/qt-everywhere-opensource-src-4.8.7.tar.gz",
            "sha256": "e2882295097e47fe089f8ac741a95fef47e0a73a3f3cdf21b56990638f626ea0"
        },
        {
            "type": "patch",
            "path": "patches/Qt4-enable-building-with-C-11-and-C-14.patch"
        },
        {
            "type": "patch",
            "path": "patches/Qt4-better-invalid-fonttable-handling.diff",
            "strip-components": 0
        },
        {
            "type": "patch",
            "path": "patches/Qt4-qsettings-null.diff",
            "strip-components": 0
        },
        {
            "type": "patch",
            "path": "patches/Qt4-gcc6.patch"
        },
        {
            "type": "patch",
            "path": "patches/Qt4-kde-fix.diff",
            "strip-components": 0
        },
        {
            "type": "patch",
            "path": "patches/Qt4-pcre.patch",
            "strip-components": 0
        },
        {
            "type": "patch",
            "path": "patches/Qt4-selection-flags-static_cast.patch"
        },
        {
            "type": "patch",
            "path": "patches/Qt4-src_corelib_io_qprocess_unix.cpp.diff",
            "strip-components": 0
        },
        {
            "type": "patch",
            "path":"patches/fix-build-icu59.patch"
        },
        {
            "type": "patch",
            "path": "patches/qt4-aarch64.patch"
        },
        {
             "type": "patch",
             "path": "patches/qt4-disable-sslv3.patch"
        },
        {
            "type": "shell",
            "commands": [
                "sed -i \"s|-O2|${CXXFLAGS}|\" mkspecs/common/{g++,gcc}-base.conf",
                "sed -i \"/^QMAKE_LFLAGS_RPATH/s| -Wl,-rpath,||g\" mkspecs/common/gcc-base-unix.conf",
                "sed -i \"/^QMAKE_LFLAGS\s/s|+=|+= ${LDFLAGS}|g\" mkspecs/common/gcc-base.conf"
            ]
        },
        {
            "type": "file",
            "path": "patches/qt4-openssl-1.1.patch"
        },
        {
            "type": "shell",
            "commands": [
                "echo -e '#include<openssl/opensslv.h>\nint main(){return OPENSSL_VERSION_NUMBER>=0x010100000L?0:1;}' >has_openssl_1_1.c",
                "gcc ${CFLAGS} has_openssl_1_1.c -o has_openssl_1_1",
                "if ./has_openssl_1_1; then patch -p1 -i qt4-openssl-1.1.patch; fi"
            ]
        }
    ],
    "cleanup": [
            "/bin",
            "/include",
            "/lib/*.a",
            "/lib/*.la",
            "/lib/*.prl",
            "/lib/pkgconfig",
            "/lib/qt4/mkspecs",
            "/lib/qt4/q3porting.xml",
            "/mkspecs",
            "/phrasebooks",
            "q3porting.xml"
        ]
    },
    {
            "name": "boost",
            "buildsystem": "simple",
            "build-commands": [
                "./bootstrap.sh --prefix=/app --with-libraries=date_time,filesystem,iostreams,python,serialization,locale,regex,system,thread",
                "./b2 --build-type=minimal link=shared",
                "./b2 --build-type=minimal link=shared install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/boost/files/boost/1.67.0/boost_1_67_0.tar.bz2",
                    "sha256": "2684c972994ee57fc5632e03bf044746f6eb45d4920c343937a465fd67a5adba"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "tinyxml",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/tinyxml/files/tinyxml/2.6.2/tinyxml_2_6_2.tar.gz",
                    "sha256": "15bdfdcec58a7da30adc87ac2b078e4417dbe5392f3afb719f9ba6d062645593"
                },
                {
                    "type": "patch",
                    "path": "patches/tinyxml_CMakeLists.patch"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "yaml-cpp",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DCMAKE_POSITION_INDEPENDENT_CODE=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jbeder/yaml-cpp/archive/yaml-cpp-0.6.2.tar.gz",
                    "sha256": "e4d8560e163c3d875fd5d9e5542b5fd5bec810febdcba61481fe5fc4e6b1fd05"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        { 
            "name": "opencolorio",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DOCIO_BUILD_JNIGLUE=OFF",
                "-DOCIO_STATIC_JNIGLUE=OFF",
                "-DOCIO_BUILD_TRUELIGHT=OFF",
                "-DUSE_EXTERNAL_LCMS=ON",
                "-DUSE_EXTERNAL_TINYXML=ON",
                "-DUSE_EXTERNAL_YAML=ON",
                "-DOCIO_USE_BOOST_PTR=ON",
                "-DOCIO_BUILD_NUKE=OFF",
                "-DOCIO_BUILD_SHARED=ON",
                "-DOCIO_BUILD_APPS=OFF",
                "-DOCIO_BUILD_DOCS=OFF",
                "-DOCIO_BUILD_STATIC=OFF",
                "-DOCIO_BUILD_TESTS=OFF"
                    ],
            "builddir": true,
            "build-options": {
                "arch": {
                    "arm": {
                        "config-opts": [
                            "-DOCIO_USE_SSE:BOOL=OFF"
                        ]
                    },
                    "aarch64": {
                        "config-opts": [
                            "-DOCIO_USE_SSE:BOOL=OFF"
                        ]
                    }
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/imageworks/OpenColorIO/archive/v1.1.0.tar.gz",
                    "sha256": "228589879e1f11e455a555304007748a8904057088319ebbf172d9384b93c079"
                },
                {
                    "type": "shell",
                    "commands": [
                        "find . -name CMakeLists.txt -exec sed -e s/-Werror// -i {} ';'"
                    ]
                }
            ],
            "cleanup": [
                "/include",
                "/cmake",
                "/lib/pkgconfig",
                "/share",
                "OpenColorIOConfig.cmake"
            ]
        },
        {
            "name": "shiboken",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_SKIP_RPATH=true",
                "-DCMAKE_BUILD_TYPE=Release",
                "-DBUILD_TESTS=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/pyside/Shiboken/archive/1.2.4.tar.gz",
                    "sha256": "1536f73a3353296d97a25e24f9554edf3e6a48126886f8d21282c3645ecb96a4"
                },
                {
                    "type": "patch",
                    "path": "patches/shiboken_gcc6.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/shiboken_memleak-instead-crash.patch"
                }
            ],
            "cleanup": [
                "/bin",
                "/include"
            ]
        },
        {
            "name": "pyside",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DBUILD_TESTS=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/pyside/PySide/archive/1.2.4.tar.gz",
                    "sha256": "90f2d736e2192ac69e5a2ac798fce2b5f7bf179269daa2ec262986d488c3b0f7"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "ilmbase",
            "config-opts": [
                "--disable-static"
            ],
            "build-options": {
                "env": {
                    "LDFLAGS": "-lpthread"
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.savannah.nongnu.org/releases/openexr/ilmbase-2.2.1.tar.gz",
                    "sha256": "cac206e63be68136ef556c2b555df659f45098c159ce24804e9d5e9e0286609e"
                },
                {
                    "type": "shell",
                    "commands": [
                        "rm config.guess configure"
                    ]
                }
            ],
            "cleanup": [
                "/include/OpenEXR",
                "/lib/*.la",
                "/lib/pkgconfig/IlmBase.pc"
            ]
        },
        {
            "name": "openexr",
            "config-opts": [
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.savannah.nongnu.org/releases/openexr/openexr-2.2.1.tar.gz",
                    "sha256": "8f9a5af6131583404261931d9a5c83de0a425cb4b8b25ddab2b169fbf113aecd"
                },
                {
                    "type": "patch",
                    "path": "patches/openexr-no-docs.patch"
                },
                {
                    "type": "shell",
                    "commands": [
                        "rm config.guess configure"
                    ]
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.la",
                "/lib/pkgconfig",
                "/share/aclocal"
            ]
        },
        {
            "name": "openjpeg",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/uclouvain/openjpeg/archive/v2.3.0.tar.gz",
                    "sha256": "3dc787c1bb6023ba846c2a0d9b1f6e179f1cd255172bde9eb75b01f1e6c7d71a"
                }
            ],
            "cleanup": [
                "/bin",
                "/include"
            ]
        },
        {
            "name": "libraw",
            "config-opts": [
                "--disable-static",
                "--enable-jasper",
                "--enable-jpeg",
                "--enable-demosaic-pack-gpl2"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.libraw.org/data/LibRaw-0.19.2.tar.gz",
                    "sha256": "400d47969292291d297873a06fb0535ccce70728117463927ddd9452aa849644"
                },
                {
                    "type": "archive",
                    "url": "https://www.libraw.org/data/LibRaw-demosaic-pack-GPL2-0.18.8.tar.gz",
                    "sha256": "0b24bcf7bbb5d13fde58bb071f94dc9354be09bc44b2bba0698493065e99f8da",
                    "dest": "./LibRaw-demosaic-pack-GPL2"
                }
            ],
            "cleanup": [
                "/bin",
                "/share/doc",
                "/include",
                "/lib/*.la"
            ]
        },
        {
            "name": "openimageio",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DOIIO_BUILD_TOOLS:BOOL=ON",
                "-DOIIO_BUILD_TESTS:BOOL=OFF",
                "-DBUILDSTATIC:BOOL=OFF",
                "-DINSTALL_DOCS:BOOL=OFF",
                "-DUSE_OPENCV:BOOL=FALSE",
                "-DUSE_OPENSSL:BOOL=FALSE",
                "-DUSE_QT:BOOL=FALSE",
                "-DUSE_PYTHON:BOOL=FALSE",
                "-DUSE_FIELD3D:BOOL=FALSE",
                "-DSTOP_ON_WARNING:BOOL=FALSE",
                "-DUSE_GIF:BOOL=TRUE",
                "-DUSE_FREETYPE:BOOL=TRUE",
                "-DUSE_FFMPEG:BOOL=FALSE",
                "-DLINKSTATIC=0",
                "-DUSE_OPENJPEG:BOOL=TRUE",
                "-DUSE_LIBRAW:BOOL=TRUE",
                "-DLIBRAW_PATH=/app/lib/libraw",
                "-DCMAKE_LIBRARY_PATH=/app/lib"
            ],
            "builddir": true,
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenImageIO/oiio/archive/Release-1.8.13.tar.gz",
                    "sha256": "24b93ebe6cc31aa92d3246b65ec66fcf626af32fcd4b04847c7f23c8e2adcabd"
                }
            ],
            "cleanup": [
                "/bin",
                "/include"
            ]
        },
        {
            "name": "gpac",
            "config-opts": [
                "--disable-shared",
                "--enable-static",
                "--disable-doc",
                "--extra-cflags=-fPIC"
            ],
            "make-install-args": [
                "install-lib"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/gpac/gpac.git"
                }
            ],
            "cleanup": [
                "*"
            ]
        },
        {
            "name": "sip",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.8/sip-4.19.8.tar.gz",
                    "sha256": "7eaf7a2ea7d4d38a56dd6d2506574464bddf7cf284c960801679942377c297bc"
                }
            ],
            "build-commands": [
                "python ./configure.py -b /app/bin -d /app/lib/python2.7/site-packages -e /app/include",
                "make",
                "make install"
            ],
            "cleanup": [
                "/bin",
                "/include"
            ]
        },
        {
            "name": "seexpr",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=release",
                "-DCMAKE_INSTALL_LIBDIR=lib"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/wdas/SeExpr/archive/v1-2.11.tar.gz",
                    "sha256": "b1395e1e87bdc75b6abc65ab8c4894b1e04ddb60c6eef277607bb6d44b31a6c2"
                },
                {
                    "type": "patch",
                    "path": "patches/seexpr-nodemos-notests.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/seexpr-fix-inline-error.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/seexpr-fix-cxxflags.patch"
                }
            ],
            "cleanup": [
                "src/SeExprEditor/generated/",
                "src/SeExpr/generated/",
                "/include",
                "/lib/*.a"
            ]
        },
        {
            "name": "openfx-io",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/NatronGitHub/openfx-io.git",
                    "tag": "Natron-2.3.14"
                },
                {
                    "type": "patch",
                    "path": "patches/openfx-io-plugins-path.diff"
                }
            ],
            "build-commands": [
                "make CONFIG=release PREFIX-=/app",
                "make install CONFIG=release DESTDIR=/app"
            ],
            "cleanup": [
                "openfx/Documentation",
                "openfx/Examples",
                "openfx/website",
                "openfx/scripts",
                "openfx/Guide",
                "openfx/HostSupport/expat-2.2.1",
                "openfx/HostSupport/examples",
                "openfx/Support/PropTester"
            ]
        },
        {
            "name": "openfx-misc",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/devernay/openfx-misc.git",
                    "tag": "Natron-2.3.14",
                    "commit": "9ccae7325ace4ac367a5121f8d3bf1b99e249ec1"
                },
                {
                    "type": "patch",
                    "path": "patches/openfx-misc-plugins-path.diff"
                },
                {
                    "type": "patch",
                    "path": "patches/openfx-misc_disable_curl.patch"
                },
                {
                    "type": "archive",
                    "url": "https://github.com/dtschump/CImg/archive/v.2.3.3.tar.gz",
                    "sha256": "b9df022c2095683af98347d5093e8ec6d385dd50d0427ad22072dd6963725fc0",
                    "dest": "./CImg-v.2.3.3"
                },
                {
                    "type": "shell",
                    "commands": [
                        "cp ./CImg-v.2.3.3/CImg.h ./CImg",
                        "cp ./CImg-v.2.3.3/plugins/inpaint.h ./CImg/Inpaint",
                        "patch -p0 -dCImg < CImg/Inpaint/inpaint.h.patch"
                    ]
                }
            ],
            "build-commands": [
                "make CONFIG=release PREFIX=/app",
                "make install CONFIG=release DESTDIR=/app"
            ],
            "cleanup": [
                "openfx/Documentation",
                "openfx/Examples",
                "openfx/website",
                "openfx/scripts",
                "openfx/Guide",
                "openfx/HostSupport/expat-2.2.1",
                "openfx/HostSupport/examples",
                "openfx/Support/PropTester"
            ]
        },
        {
            "name": "openfx-arena",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/NatronGitHub/openfx-arena.git",
                    "tag": "Natron-2.3.14",
                    "commit": "2959d4f801a1d8d152f1e0b75331493c2547f805"
                },
                {
                    "type": "patch",
                    "path": "patches/openfx-arena_disable-curl.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/openfx-arena-plugins-path.patch"
                },
                {
                    "type": "git",
                    "url": "https://github.com/lvandeve/lodepng.git",
                    "commit": "bd8f274fb51ef18b6d26b5f106ae4bef2150622e",
                    "dest": "./lodepng"
                },
                {
                    "type": "shell",
                    "commands": [
                        "cp ./lodepng/lodepng.h ./Bundle",
                        "cp ./lodepng/lodepng.cpp ./Bundle"
                    ]
                }
            ],
            "build-commands": [
                "make CONFIG=release PREFIX=/app",
                "make install CONFIG=release DESTDIR=/app"
            ],
            "modules": [
                {
                    "name": "cppunit",
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://dev-www.libreoffice.org/src/cppunit/cppunit-1.13.2.tar.gz",
                            "sha256": "3f47d246e3346f2ba4d7c9e882db3ad9ebd3fcbd2e8b732f946e0e3eeb9f429f"
                        }
                    ]
                },
                {
                    "name": "librevenge",
                    "config-opts": [
                        "--disable-werror",
                        "--disable-docs"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://sourceforge.net/projects/libwpd/files/librevenge/librevenge-0.0.4/librevenge-0.0.4.tar.xz",
                            "sha256": "933f0729f04267cc354b9a02bc3e9afefa5512a3bdd0b45f159ee14a3e3347b2"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/include",
                        "/lib/*.la"
                    ]
                },
                {
                    "name": "libcdr",
                    "config-opts": [
                        "--disable-werror",
                        "--disable-docs"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://dev-www.libreoffice.org/src/libcdr/libcdr-0.1.4.tar.bz2",
                            "sha256": "f3a3ebebebb32b9686dfe7f9df296ac5ae02ea610f3d7d5221b957bb14fc0ad3"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/lib/*.la",
                        "/include"
                    ]
                },
                {
                    "name": "libzip",
                    "buildsystem": "cmake-ninja",
                    "config-opts": [
                        "-DCMAKE_BUILD_TYPE=Release"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://libzip.org/download/libzip-1.5.1.tar.xz",
                            "sha256": "04ea35b6956c7b3453f1ed3f3fe40e3ddae1f43931089124579e8384e79ed372"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/include"
                    ]
                },
                {
                    "name": "poppler-glib",
                    "buildsystem": "cmake-ninja",
                    "config-opts": [
                        "-DENABLE_LIBCURL=OFF",
                        "-DNSS3_FOUND=OFF",
                        "-DENABLE_NSS3=OFF",
                        "-DENABLE_QT5=OFF",
                        "-DENABLE_QT4=OFF",
                        "-DENABLE_GTK_DOC=OFF",
                        "-DCMAKE_BUILD_TYPE=Release",
                        "-DENABLE_XPDF_HEADERS=ON"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://poppler.freedesktop.org/poppler-0.64.0.tar.xz",
                            "sha256": "b21df92ca99f78067785cf2dc8e06deb04726b62389c0ee1f5d8b103c77f64b1"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/include"
                    ]
                },
                {
                    "name": "cairo",
                    "config-opts": [
                        "--with-libpng=yes",
                        "--enable-static",
                        "--enable-tee"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://www.cairographics.org/releases/cairo-1.14.12.tar.xz",
                            "sha256": "8c90f00c500b2299c0a323dd9beead2a00353752b2092ead558139bd67f7bf16"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/include",
                        "/lib/*.la"
                    ]
                },
                {
                     "name": "gdk-pixbuf",
                     "buildsystem": "autotools",
                     "config-opts": [
                         "--disable-docs",
                         "--disable-static",
                         "--enable-shared",
                         "--without-libtiff"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "http://ftp.acc.umu.se/pub/gnome/sources/gdk-pixbuf/2.36/gdk-pixbuf-2.36.12.tar.xz",
                            "sha256": "fff85cf48223ab60e3c3c8318e2087131b590fd6f1737e42cb3759a3b427a334"
                        }
                    ],
                    "cleanup": [
                         "/bin",
                         "/include"
                    ]
                },
                {
                    "name": "librsvg",
                    "config-opts": [
                        "--disable-docs",
                        "--disable-static",
                        "--enable-shared",
                        "--disable-introspection",
                        "--disable-vala",
                        "--disable-pixbuf-loader"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://download.gnome.org/sources/librsvg/2.40/librsvg-2.40.20.tar.xz",
                            "sha256": "cff4dd3c3b78bfe99d8fcfad3b8ba1eee3289a0823c0e118d78106be6b84c92b"
                        }
                    ],
                    "cleanup": [
                         "/bin",
                         "/include"
                    ]
                },
                {
                    "name": "imagemagic",
                    "config-opts": [
                        "--with-magick-plus-plus=yes",
                        "--with-quantum-depth=32",
                        "--without-dps",
                        "--without-djvu",
                        "--without-fftw",
                        "--without-fpx",
                        "--without-gslib",
                        "--without-gvc",
                        "--without-jbig",
                        "--without-jpeg",
                        "--with-lcms",
                        "--without-openjp2",
                        "--without-lqr",
                        "--without-lzma",
                        "--without-openexr",
                        "--with-pango",
                        "--with-png",
                        "--with-rsvg",
                        "--without-tiff",
                        "--without-webp",
                        "--with-xml",
                        "--with-zlib",
                        "--without-bzlib",
                        "--disable-static",
                        "--enable-hdri",
                        "--enable-openmp",
                        "--with-freetype",
                        "--with-fontconfig",
                        "--without-modules",
                        "--without-x"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://www.imagemagick.org/download/releases/ImageMagick-7.0.8-29.tar.xz",
                            "sha256": "41590d506e2b4a7df7325934cb906db067d5cbb387c80fb05643186c8b6439e3"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/include",
                        "/lib/*.la"
                    ]
                }
            ]
        },
        {
            "name": "openfx-gmic",
            "buildsystem": "simple",
            "build-options": {
                "env": {
                    "CXXFLAGS": "--param ggc-min-expand=20 --param ggc-min-heapsize=32768"
                }
            },
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/NatronGitHub/openfx-gmic.git",
                    "tag": "Natron-2.3.14",
                    "commit": "096fe05434e077077f804f5a3f2e7d5715f7519c"
                },
                {
                    "type": "file",
                    "url": "http://gmic.eu/files/source/gmic_2.3.3.tar.gz",
                    "sha256": "46417d48d9dd87a155ba979667834a7d6899652f097cc25652e0680ee0b13c6a",
                    "dest": "./"
                },
                {
                    "type": "git",
                    "url": "https://github.com/dtschump/gmic-community.git",
                    "commit": "ccfb3190aa414c4c09db643e1ea6ff446dbbd67f",
                    "dest": "./gmic-community"
                },
                {
                    "type": "shell",
                    "commands": [
                        "cp ./gmic-community/libcgmic/gmic_libc.h ./",
                        "cp ./gmic-community/libcgmic/gmic_stdlib_gmic.h ./",
                        "cp ./gmic-community/libcgmic/gmic_libc.cpp ./"
                    ]
                },
                 {
                    "type": "patch",
                    "path": "patches/openfx-gmic_plugin_path.patch"
                }
            ],
            "build-commands": [
                "make -j${MKJOBS} OPENMP=1 CONFIG=release PREFIX=/app",
                "make install CONFIG=release DESTDIR=/app"
            ],
            "modules": [
                {
                    "name": "fftw3",
                    "config-opts": [
                        "--enable-threads",
                        "--enable-openmp",
                        "--with-pic"
                    ],
                    "build-options": {
                        "arch": {
                            "x86_64": {
                                "config-opts": [
                                    "--enable-sse2",
                                    "--enable-avx",
                                    "--enable-avx-128-fma"
                                ]
                            }
                        }
                    },
                    "sources": [
                        {
                            "type": "archive",
                            "url": "http://www.fftw.org/fftw-3.3.7.tar.gz",
                            "sha256": "3b609b7feba5230e8f6dd8d245ddbefac324c5a6ae4186947670d9ac2cd25573"
                        }
                    ],
                    "cleanup": [
                        "/bin",
                        "/include",
                        "/lib/*.la"
                    ]
                }
            ]
        },
        {
            "name": "natron",
            "buildsystem": "qmake",
            "config-opts": [
                "CONFIG+=stable",
                "CONFIG+=enforce-gcc8"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/NatronGitHub/Natron.git",
                    "tag": "2.3.14",
                    "commit": "a0979febfa9c5e9d7aebf71439479ebf6ba04d69"
                },
                {
                    "type": "patch",
                    "path": "patches/natron_plugins-path.diff"
                },
                {
                    "type": "patch",
                    "path": "patches/natron_fix_path.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/fix_project_mime_icon.patch"
                },
                {
                    "type": "file",
                    "path": "config.pri"
                },
                {
                    "type": "archive",
                    "url": "https://github.com/NatronGitHub/OpenColorIO-Configs/archive/Natron-v2.3.tar.gz",
                    "sha256": "0192bd27e467332c4e61c0103804198f941c88f43df7d9ba8ebb41b79adda640",
                    "dest": "./OpenColorIO-Configs"
                }
            ],
            "post-install": [
                "mv /app/share/mime/packages/x-natron.xml /app/share/mime/packages/fr.natron.Natron.xml",
                "install -Dm644 ./Gui/Resources/Images/natronIcon256_linux.png /app/share/icons/hicolor/256x256/apps/natronIcon256_linux.png",
                "install -Dm644 ./Gui/Resources/Images/natronIcon.svg /app/share/icons/hicolor/scalable/apps/fr.natron.Natron.svg",
                "install -Dm644 ./Gui/Resources/Images/natronProjectIcon_linux.png /app/share/icons/hicolor/256x256/mimetypes/fr.natron.Natron-project.png",
                "mkdir -p /app/Plugins && cp -r ./Gui/Resources/PyPlugs /app/Plugins/PyPlugs",
                "cp -r /app/lib/python2.7/site-packages/PySide /app/Plugins/PySide",
                "cp -r ./Gui/Resources/etc/ /app"
            ]
        }
    ]
}
